# -------------------------------
# Deployment: Pod를 원하는 개수만큼 유지·관리하는 리소스
# -------------------------------
apiVersion: apps/v1          # Deployment 리소스의 API 버전
kind: Deployment             # 이 리소스의 종류는 Deployment
metadata:
  name: backend-deployment   # Deployment 이름 (kubectl에서 식별용)
spec:
  replicas: 2                # 동시에 실행할 Pod 개수
                             # Pod가 죽으면 자동으로 다시 1개 생성
  selector:
    matchLabels:
      app: backend           # 이 Deployment가 관리할 Pod를 선택하는 기준
  template:                  # Pod의 설계도 (Deployment가 Pod를 만들 때 사용)
    metadata:
      labels:
        app: backend         # Pod에 붙는 라벨
                             # Service가 이 라벨로 Pod를 찾음
    spec:
      containers:
        - name: backend      # Pod 안에서 실행될 컨테이너 이름
          image: tenma2/product-service:1768797703-da5241c
          imagePullPolicy: Always # 중요! 항상 저장소에서 다운로드 받도록 변경 (기존 Never)
          ports:
            - containerPort: 4000
                             # 컨테이너 내부에서 애플리케이션이 사용하는 포트

---
# --------------------------------
# Service: Pod에 접근하기 위한 고정된 네트워크 진입점
# --------------------------------
apiVersion: v1               # Service의 API 버전
kind: Service                # 리소스 종류는 Service
metadata:
  name: backend-service      # Service 이름
spec:
  type: LoadBalancer         # 외부에서 접근 가능한 Service
                             # (클라우드에서는 LB 생성,
                             # 로컬에서는 동작이 제한적)
  selector:
    app: backend             # app=backend 라벨을 가진 Pod로 트래픽 전달
  ports:
    - protocol: TCP          # TCP 통신 사용
      port: 4000             # 외부에서 접근할 포트
      targetPort: 4000       # Pod 내부 컨테이너 포트로 연결

